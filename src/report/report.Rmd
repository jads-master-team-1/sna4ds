---
title: "Cohesion within the European Parliament: a social network analysis"
shorttitle: "Cohesion within the European Parliament"
author:
- name: Iona Donaldson (2064159)
- name: Colette van Happen (2069244)
- name: Olivier Spinnler (2007452)
- name: Tom de Wildt (2068292)
- name: Laurens Priem (1274328)
- name: Bram Delisse (2065006)
output:
  html_document:
    df_print: paged
  pdf_document: default
authornote: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.
  Enter author note here.
keywords: keywords
wordcount: X
bibliography: r-references.bib
toc: yes
toc_float: yes
floatsintext: no
figurelist: no
tablelist: no
footnotelist: no
linenumbers: no
mask: no
draft: no
documentclass: apa6
classoption: man
affiliation:
- id: '1'
  institution: JADS
---

```{r setup, include = FALSE}
library("papaja")
r_refs("r-references.bib")
```

```{r analysis-preferences, include = FALSE}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

<!--
Citations in papaja (delete appropriately later)

Add the bibtex entry in the .bib file. You can find the entries in Google scholar, 
but double check since it is not always correct. 

Call the citations in the text:

Citation within parentheses	[@R-papaja]

Multiple citations	[@R-papaja; @R-base]

In-text citations	@R-papaja

Year only	[-@R-base]

Only if your citation appears in the text it will also show up in the Reference 
list. Don't manually modify the Reference list.
-->
```{r echo=FALSE}
#Inputting data in one place
mep <- read.csv("../../data/MEP_data.csv", header = T, sep = ",")
edges_soc_clim <- read.csv("../../data/edges_for_against_social.csv", header = T, sep = ",")
edges_ind_clim <- read.csv("../../data/edges_for_against_industry.csv")
```

```{r echo=FALSE}
colour_network <- function(network){
  igraph::V(network)$color <- 'gray'
  igraph::V(network)$color <- ifelse(igraph::V(network)$group_abbv== 'EPP', "blue", igraph::V(network)$color)
  igraph::V(network)$color <- ifelse(igraph::V(network)$group_abbv== 'IDG', "blue4", igraph::V(network)$color)
  igraph::V(network)$color <- ifelse(igraph::V(network)$group_abbv== 'S&D', "red", igraph::V(network)$color)
  igraph::V(network)$color <- ifelse(igraph::V(network)$group_abbv== 'ECR', "dodgerblue3", igraph::V(network)$color)
  igraph::V(network)$color <- ifelse(igraph::V(network)$group_abbv== 'REG', "yellow", igraph::V(network)$color)
  igraph::V(network)$color <- ifelse(igraph::V(network)$group_abbv== 'Greens/EFA', "green", igraph::V(network)$color)
  igraph::V(network)$color <- ifelse(igraph::V(network)$group_abbv== 'The Left', "red4", igraph::V(network)$color)
  igraph::V(network)$color <- ifelse(igraph::V(network)$group_abbv== 'NI', "slategray4", igraph::V(network)$color)
  return(network)
}
```


## Executive Summary
<!--
Executive Summary Description (150 words) – 0.3 POINTS

Basically an Abstract.

Summarize the report. Write this as the very last thing.

What is the main topic you are addressing?

What are your research questions and hypotheses?  

What are your results and the main conclusion?
-->

## Introduction 
<!--
Introduction Description (about 1000 words) – 0.5 POINTS

Place your topic of choice within the existing literature and explain what you 
are going to address in this report and why.

*	What is the main topic that is going to be studied in this paper?

*	Why is it important?

*	What are the existing studies that address it already?

*	What are your questions and hypotheses? Why are they important? How are they 
connected to previous work or to a problem you raised?

*	Which methods are you using? Why?

*	How is your work going to contribute to the field/or to whom (e.g., industry)?

*	What does the rest of the report look like? In one short paragraph, list the 
topics of the following sections.
-->

### Topic of choice and literature review
The European Parliament (EP) is composed of 705 members, all elected officials. While these officials are elected to represent the European people as a whole, they are often also a member of a national party of one of the European Union (EU) member states. The officials of national parties then form European groups in the EP based on the ideology of the national parties.

An interesting political clash to investigate is between ideology and national interest. European groups are formed based on a common ideology, yet all its internal members also have to take national interest into account. Probably it is the case that for certain bills that are closely connected to the ideology of a group, unity inside that European group is very high. At the same time, bills that are further apart from the ideology and where national interest play a larger role may lead to a different and more varied voting behavior for the group. For instance, we expect a high level of unity inside the Greens group when they are voting on a bill related to climate. At the same time, such a group might be more influenced by national interests when it votes on a bill related to industry or economic activity. The catch here is that the industry bill might also have an effect on the climate. This begs the overarching question about how consistent European groups vote across bills. Does the network from one bill significantly differ from a network from a different bill? We want to investigate this using the following research question:

_RQ1: “What is the correlation between the network from the climate bill and the network from the industry bill?”_

Along with the research question, the following hypothesis is formulated:

_H1: “We expect a high level of correlation”._

<!--
Should we perhaps specify exactly what we mean with "high level of cohesion/correlation"? What is high?
-->

The purpose of the European group is to have unity in the voting behavior of its members. However, it can be the case that the interests from certain national parties clash with those from the European group. For instance, the European Christen Democrats group (EPP) has been in a big dispute with Hungary's Fidesz party, eventually even leading to the national party leaving the group after being threatened to get kicked out [@de_la_baume_orbans_2021]. 

Given potential clashes between national and European interests, we are very interested to investigate the unity and dynamics inside European groups. As such, we have formulated the following research question:

_RQ2: “What is the cohesion of agreement, based on the climate and industry bill, within every European group?”_

Along with the research question, the following hypothesis is formulated:

_H2: “We expect a high level of cohesion for both bills”._

Here we define cohesion in line with the definition provided by [@cherepnalkoski_karpf_mozetic_grcar_2016] who view cohesion as the propensity to vote in the same manner within the same group, here the same European parliamentary group.

Our work is going to contribute to the field by providing additional insight into the voting behaviors of given members of the European Parliament (MEPs). Our data being recent (2021) can suggest whether voting patterns are staying similar in time in comparison to other studies such as [@Eveland2013; @Schneider2007; @Nicoll_Victor2017]. 

The study will give possible factors that influence the final voting outcome for a given bill. The tools deployed to tackle this problem are described in further sections. They will allow to compare objectively using statistical tools, for instance ERGM. The creation of these models allow a better understanding of which factors influence the formation and dissociation of coalitions and political party cohesions.

#### Roll-call votes
The analysis conducted in this paper is carried out over a set of 61 roll-call votes from two motions for European Parliament resolutions concerning different political areas of interest (45 from a climate-related motion and 16 from an industry-related motion). Roll-call votes are votes conducted in the European parliament where the vote (or absence of vote in some cases) of an MEP is recorded along with their name. Roll-call votes are only held under certain conditions, for example, when requested by a significant number of MEPs or if it is impossible to determine a majority from a show of hands [@cherepnalkoski_karpf_mozetic_grcar_2016]. These votes are documented in the minutes of that day’s parliament session and are accessible on the European parliament site.

### Proceeding of report's parts
Firstly the methodology is explained. Some general comments are made on the obtention of the data, exploratory results under the form of plots. 
Secondly, an explanation of the exact manner of how the network and its modelling is constructed.
Thirdly, an interpretation of the modelling results of the networks, how it relates and partially answers the research question given previously.



## Methodology

### Dataset 
<!-- 
Dataset Description (about 500 words) 1 POINT (+ BONUS)

*	Which data set are you going to use? Three options:

  *	Use readily/easily available data (0 bonus points)

  *	Combine two or more existing datasets (max 0.5 bonus points)

  *	Scrape or collect your own data (max. 1 bonus point)

*	Clearly explain where the data is coming from:

  *	Who collected the data?

  *	What is the source?

  *	When was the data produced?

  *	How was the data collected?

*	Provide descriptive measures of your data (tables, plots, etc.)


*	Why is this data useful to study your topic and answer your research questions?

*	What is the potential bias in the data? How does this affect your results?
-->

#### Source of data and collection
As the dataset for this research two votes of the European Parliament, both on May 18th 2021, are scraped from the VoteWatch.eu website. The code used to scrape the data can be found in the appendix<!--ADD REFERENCE TO APPENDIX-->. The first vote is named "The impacts of climate change on vulnerable populations in developing countries", and has 44 roll-calls. The second vote is named "Research Fund for Coal and Steel", and has 16 roll-calls. The full official document of the votes can be found in the Appendix<!--ADD REFERENCE TO APPENDIX-->. VoteWatch is a non-profit organization with the goal of providing insight into the European Parliament and their decision making for European citizens. VoteWatch describes their methodology on their website to a great extend [@noauthor_votewatchmethodology_nodate]. The foundation, however, lays in them automatically scraping the the voting data from the European Parliaments own website.

The two analysed votes are purposefully chosen in order to analyze the potential difference in the network effects within the European Parliament for different areas of politics. Stereo typically, political views on climate change on the one hand, and coal & steel industry on the other hand are often adverse, which make these votes interesting to analyze. Furthermore, the votes took place on the same date, which eliminates influence of various possible external parameters. Some examples of such parameters are the date of the vote, the composition of the parliament, or short-lived political ideologies.

#### Usefulness of data for research questions and potential biases
The collected data concerns the names of MEPs, their nationality, European-level political party and vote for each relevant motion for resolution. This data provides enough information to be able to answer the research questions discussed above, as the effect of political party and nationality on agreement between MEPs can be modeled. The collection of data from two motions in different fields also provides the opportunity to be able to compare the network of agreement between the two areas and comment on similarities and differences. The creation of two networks from these two datasets is discussed in the next section of this paper.
A limitation of the data collected is the lack of information about the personal network dynamics at play in the European parliament. Agreement between individuals is likely also influenced by who they are friends with and collaborate with most often. There are likely also more powerful members of the party such as national and European-party level leaders who may therefore invoke a higher level of agreement from others. With the data collected these dynamics are either impossible to model or can only be done in a limited manner.
For this research only two motions were chosen rather than examining all relevant motions in the current period. This has been carried out in previous research, see @cherepnalkoski_karpf_mozetic_grcar_2016 but was deemed to be too time consuming for this initial research. The research carried out in this paper is therefore considered to be a point-in-time comparison which could trigger future investigation if this brief analysis indicates interesting results.
An issue with the collection method of the roll-call data is that it was collected via a third-party website VoteWatch rather than the European parliament website. This decision was taken due to the significant difference in ease in navigating and accessing the data on the two sites. The risk of this choice is considered to be small as the aim of VoteWatch is transparency so the data is likely to be accurate. However, it is not impossible that inaccuracies and differences could have been caused when reproducing the vote results between the two websites. Given more time to conduct this research, a next step would be to build a method for finding the relevant votes in the European parliament minutes and scraping the data directly.

### Research Rationale
<!--
Data Analysis (Research Rationale) (about 500 words) – 1 POINTS

*	Why are these two methods suitable for your data?

*	Why are these two methods suitable for your research questions?

*	Are there other methods to address these questions? If yes, why are the 
methods you chose better for this case?
-->

The first research question investigates whether there is cohesion of agreement, based on the MEP’s voting behaviour for the climate bill, within every European group. In the climate bill network two MEP’s are connected if they agree on an arbitrary amount of amendments within the bill. Since we want to explain the reason why a tie is formed in the network or specifically between two MEP’s, we propose to use an exponential random graph family model or ERGM for short. An ERGM is a class of network models to perform causal inference and deduce the cause of an observed relation phenomenon that we observe and conceptualize as a network. The model will include endogenous and exogenous terms since the party membership is an attribute of the vertices and therefore a term like nodefactor needs to be used. Nodefactor is a Markovian term that measures the extent to which being in a certain category influences edge formation. We specifically need to use the regular variant as opposed to the directed in or directed out variant since the climate bill network is undirected. The complexity and flexibility of ERGM makes this technique very suitable to verifying this research question. The other techniques are not suitable for this type of analysis since CUG and QAP are used for checking whether a network statistic is statistically significant and comparing two networks respectively.
<!--
Bram 15/nov: Maybe add something about previous research using ERGM (see list below)
There are numerous studies that used this method such as:
• Gondal, The local and global structure of knowledge production in an emergent research field, SOCNET 2011 
• Lomi and Palotti, Relational collaboration among spatial multipoint competitors , SOCNET 2011 
• Wimmer & Lewis, Beyond and Below Racial Homophily, AJS 2010 
• Lusher, Masculinity, educational achievement and social status, GENDER & EDUCATION 2011 
• Rank et al. (2010). Structural logic of intra-organizational networks, ORG SCI, 2010.
-->

The second research question looks into the correlation between the network from the climate bill and the network from the industry bill. We propose to use a QAP correlation test to find an answer for this question. QAP is similar to CUG, in that it uses statistical simulation to generate a distribution of hypothetical networks. However, with QAP we do not generate a series of random graphs (with some properties such as a given size and density), but we now control for all purely structural properties of the two graphs being compared themselves. This is done by making permutations of the networks that are to be compared, similar to the practice of bootstrapping.

A QAP correlation test is the most suitable option. A QAP test is suitable for situations where two or more networks have to be compared with each other. For the second research question, two networks, based on votes from two different bills, have to be compared. A CUG model would not work here, since it is only about investigating the network measures of one network. Similarly, an LNAM model focuses on the social influence in a network and is not applicable. It might be possible to make two ERGM models for the bills, where explanatory variables are included that represent groups that vote alike, but this would be needlessly complex and inferior to the QAP test. Lastly, a MRQAP model is not necessary since only two networks have to be compared. 

## Results
<!--
Results Description (about 2000 words)
-->
### Creation of the networks
A decision was needed to be made regarding the nature of the edges in the network. One technique could be that agreement between MEPs would be summed creating a weighted edge equaling the number of times the two MEPs agreed in the bill. This network can be used for our first research question using a QAP-test to look at correlation. However, for the second research question, a traditional ERGM model can only handle binary edges. More recent ERGM techniques can cope with weighted edges, however due to the scale of the network in question (705 nodes) this was not considered feasible during the time-period of this research and could be considered as a future area of research based on the results of this paper.

Therefore, in order to create a binary network of agreement between MEPs a decision was required to determine what conditions would create an edge between a pair of MEPs. Previous research has created networks from each individual roll-call vote where an edge equals agreement in that particular vote [@cherepnalkoski_karpf_mozetic_grcar_2016]. In this research it was also decided that each edge should represent agreement between two MEPs. While it is clear that two MEPs are in agreement if they both vote for or both against a motion, this is less clear in the case of abstaining, being absent or just not voting. This could be due to disagreement with the motion, perhaps an unwillingness to go against your party but could also be due to a personal issue, logistical problem or lack of information. It is therefore not possible to say if these MEPs have the same opinion about the vote. An agreement is therefore only considered valid in this research if they both voted for or against. However, being able to make conclusions from this method requires an ERGM model to be created for each roll-call vote and then the results combined using a meta-analysis method. Therefore, given the time restrictions of this project, a decision was made to create an edge between individuals based on agreement in a certain number of votes or more following the approach adopted in previous papers, see @cranmer_desmarais_2011, and thus implenting a so called threshold. More about this threshold is explained later in the results. 

### Descriptive measures

In order to get a better overview of the dataset, the five-number summary is computed for both the climate motion and the industry motion. The following two tables show these statistics for the two weighted networks where there is an edge between MEPs if they agree in at least one sub-vote. As this is an undirected graph we just show the number of nodes and edges rather than the dyad-cencus since this would not provide any additional information.The centrality chart for these networks was also examined but was difficult to interpret given number of nodes included. Additionally, the centrality chart pointed towards the low centrality of the graphs which is easy to confirm with the statistics below. Due to the high transivity and density of the graph, there are not many specific nodes that are more/less central in the graphs.

The summary statistics of the graph already point to a high level of similarity in structure. They both have very high density and transitivity. They also have the same path length and diameter, likely due to the many connections between nodes in both graphs.

```{r echo=FALSE}
edges_soc_clim$AgreementPercent <- round(edges_soc_clim$Agreement/44, digits=2)
edges_ind_clim$AgreementPercent <- round(edges_ind_clim$Agreement/16, digits=2)
```


```{r echo=FALSE}
w_edges_soc_clim <- edges_soc_clim[edges_soc_clim[, "Agreement"]>=1, c("MEP_1","MEP_2")]
w_network_soc_clim <- igraph::graph_from_data_frame(w_edges_soc_clim, vertices=mep, directed=FALSE)
w_network_soc_clim  <- igraph::set_edge_attr(w_network_soc_clim , "weight", value= edges_soc_clim$AgreementPercent)

cn <- c("Measurement", "Value")
nonodes <- c("Number of nodes",igraph::vcount(w_network_soc_clim))
noedges <- c("Number of edges",igraph::ecount(w_network_soc_clim))
trans <- c("Transitivity", sprintf(igraph::transitivity(w_network_soc_clim), fmt = '%#.3f'))
dens <- c("Graph density", sprintf(igraph::edge_density(w_network_soc_clim), fmt = '%#.3f'))
avg_path <- c("Average path length", sprintf(igraph::mean_distance(w_network_soc_clim), fmt = '%#.3f'))
diam <- c("Diameter", igraph::diameter(w_network_soc_clim))
tab <- rbind(cn, nonodes,noedges,trans, dens, avg_path, diam)
rownames(tab) <- NULL
knitr::kable(tab, caption = "Statistics for weighted climate network")

w_edges_ind_clim <- edges_ind_clim[edges_ind_clim[, "Agreement"]>=1, c("MEP_1","MEP_2")]
w_network_ind_clim <- igraph::graph_from_data_frame(w_edges_ind_clim, vertices=mep, directed=FALSE)
w_network_ind_clim  <- igraph::set_edge_attr(w_network_ind_clim , "weight", value= edges_ind_clim$AgreementPercent)

cn <- c("Measurement", "Value")
nonodes <- c("Number of nodes",igraph::vcount(w_network_ind_clim))
noedges <- c("Number of edges",igraph::ecount(w_network_ind_clim))
trans <- c("Transitivity", sprintf(igraph::transitivity(w_network_ind_clim), fmt = '%#.3f'))
dens <- c("Graph density", sprintf(igraph::edge_density(w_network_ind_clim), fmt = '%#.3f'))
avg_path <- c("Average path length", sprintf(igraph::mean_distance(w_network_ind_clim), fmt = '%#.3f'))
diam <- c("Diameter", igraph::diameter(w_network_ind_clim))
tab <- rbind(cn, nonodes,noedges,trans, dens, avg_path, diam)
rownames(tab) <- NULL
knitr::kable(tab, caption = "Statistics for weighted industry network")

```

As previously discussed, to begin the ERGM testing it was required to transform the networks from weighted networks to binary networks. This required the choice of thresholds. Therefore to aid this process, the five-number summary was plotted for the networks using all possible absolute number thresholds (see plots below).Histograms of the spread of agreement are also plotted below to provide context for the other statistics.
There will therefore be an edge between two parliament members if they have a minimum agreement equal or above the threshold. The lowest threshold for an edge in these graphs is therefore one, meaning that the MEPs agreed on one and only one subvote in the bill. For low level of agreement this could therefore mean that MEPs only agreed very few times. Therefore not all edges are a result of causal relationships or represent a significant amount of agreement. The aim was therefore to set thresholds so as to create a network of the most important, non-random relationships. The plots below are therefore examined to try and determine the most appropriate thresholds.
For clarity the thresholds considered here are absolute numbers of votes on which the MEPs agree on. Since every MEP has the opportunity to be both present and vote on each motion for each resolution then this is considered to be a clear and fair method for testing levels of agreement.

```{r echo=FALSE}

plot_statistic <- function(fun,edges,num_votes,ylab,title){
  df <- data.frame(agreement=integer(), statistic=double())
  for (i in 1:num_votes) {
    edges_filter <- edges[edges[, "Agreement"]>i, c("MEP_1","MEP_2")]
    network_filter <- igraph::graph_from_data_frame(edges_filter, vertices=mep, directed=FALSE)
    stat_filter <- fun(network_filter)
    de <- list(agreement=i, statistic=stat_filter)
    df = rbind(df,de, stringsAsFactors=FALSE) 
  }
    plot(df, type="l", col="blue", xlab="Agreement Threshold", ylab=ylab, main=title)
}

# Social climate bill
hist(edges_soc_clim$Agreement, col = "lightblue", xlab = "Agreement",main='Histogram of spread of agreement between MEPs')
par(mfrow = c(2,2), cex=0.6)
plot_statistic(igraph::transitivity, edges_soc_clim, 44, "Global transitivity", "Transitivity as a function of agreement threshold")
plot_statistic(igraph::edge_density, edges_soc_clim, 44, "Network density", "Network density as a function of agreement threshold")
plot_statistic(igraph::mean_distance, edges_soc_clim, 44, "Average path length", "Average path length a function of agreement threshold")
plot_statistic(igraph::diameter, edges_soc_clim, 44, "Diameter", "Diameter as a function of agreement threshold")
mtext("Climate Motion",side=3,line=-19,outer=TRUE)


# Industry climate bill
hist(edges_ind_clim$Agreement, col = "lightblue", xlab = "Agreement",main='Histogram of spread of agreement between MEPs')
par(mfrow = c(2,2), cex=0.6)
plot_statistic(igraph::transitivity, edges_ind_clim, 16, "Global transitivity", "Transitivity as a function of agreement threshold")
plot_statistic(igraph::edge_density, edges_ind_clim, 16, "Network density", "Network density as a function of agreement threshold")
plot_statistic(igraph::mean_distance, edges_ind_clim, 16, "Average path length", "Average path length a function of agreement threshold")
plot_statistic(igraph::diameter, edges_ind_clim, 16, "Diameter", "Diameter as a function of agreement threshold")
mtext("Industry Motion",side=3,line=-19,outer=TRUE)


```


#### Climate Motion

The graphs for the climate motion initially show a dense network with a short average path length. This can be explained by the fact that with the full dataset, almost all members of the EP are connected to each other through at least one voting agreement. This is logical, given that they would just need to agree on one vote. However, this is not the most relevant information for this research. 

Instead, two key points of change are noted in the graphs: agreement between 12-18 and agreement above 38. For expample,it is observed from the transitivity measure figure that at an agreement threshold of 15, there is a drop in transitivity. This signals that there is a reduction in clusters when a threshold of 15 is set. Similarly, the network density plot shows a vast decline around the threshold of 15, indicating a large reduction of edges. This behaviour can be seen when plotting the graphs (see plots below- MEPs have been plotted with their European party clearer to make clustering behaviour more obvious) as clearer subcommunities begin to appear. The median amount of agreement between MEPs in this dataset of 17 also underlines this range being a significant point in the network. 

Additionally, a small drop in transitivity and density can be observed at an agreement threshold above 38 as well. This is interesting to observe, since at an agreement threshold of 38 and above, the MEPs agree on almost all votes. The density plot also shows, that there are fewer connections left, indicating that a smaller proportion of MEPs agree with each other at this significant level.This is clear when comparing the relevant plot where initially at a threshold of 38 there is still one large community. When the threshold is raised to 44 then this community has fractured into much smaller sub-groups

```{r echo=FALSE}
plot_network <- function(edges,threshold, layout) {
  edges <- edges[edges[, "Agreement"]>=threshold, c("MEP_1","MEP_2")]
  #Create network
  network <- igraph::graph_from_data_frame(edges, vertices=mep, directed=FALSE)
  #Plot network
  isolates_network = which(igraph::degree(network)==0)
  network_vis <- igraph::delete.vertices(network, isolates_network)
  network_vis <- colour_network(network_vis)
  plot(network_vis,
     vertex.size = 4,
     edge.size = .4,
     vertex.label=NA,
     layout = layout,
     main=paste('Threshold of',threshold,',', length(isolates_network), 'isolated nodes removed', sep=" "))
}

par(mfrow=c(1,2))
plot_network(edges_soc_clim,12,igraph::layout_with_lgl)
plot_network(edges_soc_clim,17,igraph::layout_with_lgl)

par(mfrow=c(1,2))
plot_network(edges_soc_clim,38,igraph::layout_with_graphopt)
plot_network(edges_soc_clim,44,igraph::layout_with_graphopt)
```


#### Industry Motion

As for the industry motion, a dense network with a short average path length can be observed as well for the full network. Again, all members are connected to each other through some voting agreement. As such, it becomes even more important to eliminate the random voting agreements in order to visualise the most important relationships between members of the European Parliament. 

The transitivity clearly shows two key drops between 3-5 and 11-14. This signals that there is a reduction in clusters. Similarly, the density plot also signals a drop in density at a threshold of 4 and 13, indicating that many connections disappear at these stages.This matches the results from the histogram as there are many pairs of MEPs with agreement around these levels. The changes to the network are modelled in the visualisations below, particularly in the comparison of the threshold of 3 and 5 where there has been a clear fracturing into subcommunities.

In contrast to the climate motion the median in agreement in this data is 13 showing a much higher average amount of agreement in this network.This is likely due to the high number of MEPs (around 5000) pairs that are in total agreement across all votes.

```{r echo=FALSE}
plot_network <- function(edges,threshold, layout) {
  edges <- edges[edges[, "Agreement"]>=threshold, c("MEP_1","MEP_2")]
  #Create network
  network <- igraph::graph_from_data_frame(edges, vertices=mep, directed=FALSE)
  #Plot network
  isolates_network = which(igraph::degree(network)==0)
  network_vis <- igraph::delete.vertices(network, isolates_network)
  network_vis <- colour_network(network_vis)
  plot(network_vis,
     vertex.size = 4,
     edge.size = .4,
     vertex.label=NA,
     layout = layout,
     main=paste('Threshold of',threshold,',', length(isolates_network), 'isolated nodes removed', sep=" "))
}

par(mfrow=c(1,2))
plot_network(edges_ind_clim,3,igraph::layout_with_lgl)
plot_network(edges_ind_clim,5,igraph::layout_with_lgl)

par(mfrow=c(1,2))
plot_network(edges_ind_clim,11,igraph::layout_with_graphopt)
plot_network(edges_ind_clim,14,igraph::layout_with_graphopt)
```

<!-- The piece below should be under Threshold determination? -->
For the climate motion, it can be assumed that by setting the threshold slightly past 15 will eliminate random edges between members of the EP. As for the threshold of 39, it would be interesting to observe given that the remaining connections capture extreme agreement, relevant to our research. As for the industry motion, it can be concluded that a threshold of 4 definitely removes the first set of random voting agreements. Additionally, a threshold of 13 also removes a large set of edges between members of the European Parliament, but it is yet to be evaluated whether these are random agreements or not. Instead, the threshold of 13 actually captures connections with extreme agreement. Therefore it would be interesting to use the number of voting agreements of 4 and 13 as thresholds for the remaining of our research.

### Threshold determination

Following the descriptive analysis, an appropriate threshold had to be determined. If the threshold would be too low then it would be more likely to cause degenerate graphs as most MEPs are likely to agree with each other on at least a few occasions leading to very dense graphs. On the other hand, if a too high threshold is selected then interesting network dynamics could be omitted by only including edges between MEPs who almost completely agree with each other. A balance therefore had to be found by examining the networks for a selection of thresholds, comparing density and the resulting ERGM model.

As previously discussed, in the previous descriptive analysis both datasets had two specific ranges where the structure of the network significantly changed. The decision was therefore made to set the threshold for the networks used in this paper just above these ranges. This was chosen as it was considered likely that the more frequent levels of agreement between MEPs were likely be chance- particularly at lower levels.

In order to be able to compare the analysis of both networks it was considered desirable to use the same thresholds on both. Therefore percentage thresholds were identified to be used: above 35% agreement and above 95% agreement. These both relate to the two ranges identified in the descriptive models above and their respective medians.See the histogram below (climate frequency in peach and industry frequency in lilac, pink where they overlap) for an illustration of the dynamics focused on by setting these thresholds.

With this data in mind, the networks models were created, visualised and tested with the ERGM (see plots and degree distribution of selected networks below). Summary statistics for these networks were also computed (see below) showing most significantly differences in graph density and diameter of the graphs (note: the centrality charts for these networks were also computed but again failed to show significant results due to the scale of the network- the only point of note was the range of degree which can be seen already in the degree distribution plotted below).
All selected networks were all separately tested to ensure the best chance of finding a converging ERGM model. It is also possible that different dynamics might be in play in the model for occasional agreement (above 35%) in comparison to almost total agreement (above 95%) which can be tested with these models. 

```{r echo=FALSE}
p1 <- hist(edges_ind_clim$AgreementPercent)
p2 <- hist(edges_soc_clim$AgreementPercent)
plot(p1 , col=rgb(0,0,1,1/4), xlim=c(0,1), main='Histogram of edges for climate and industry with selected thresholds', xlab= 'Agreement frequency')  # first histogram
plot(p2 , col=rgb(1,0,0,1/4), xlim=c(0,1), add=T)  # second
abline(v = 0.35, col='blue', lwd=3)
abline(v = 0.95, col='blue', lwd=3)
```

```{r echo=FALSE}
plot_network_perc <- function(edges,threshold_perc, layout) {
  edges <- edges[edges[, "AgreementPercent"]>=threshold_perc, c("MEP_1","MEP_2")]
  #Create network
  network <- igraph::graph_from_data_frame(edges, vertices=mep, directed=FALSE)
  #Plot network
  isolates_network = which(igraph::degree(network)==0)
  network_vis <- igraph::delete.vertices(network, isolates_network)
  network_vis <- colour_network(network_vis)
  plot(network_vis,
     vertex.size = 4,
     edge.size = .4,
     vertex.label=NA,
     layout = layout,
     main=paste('Threshold of',threshold_perc,',', length(isolates_network), 'isolated nodes removed', sep=" "))
  return(network)
}

#Plot network
par(mfrow=c(1,2))
network_soc_clim_35 <- plot_network_perc(edges_soc_clim,0.35,igraph::layout_with_graphopt)
hist(igraph::degree(network_soc_clim_35), ylim=c(0,600), xlab="Degree", main='Degree distribution with threshold 35%')

par(mfrow=c(1,2))
network_soc_clim_95 <- plot_network_perc(edges_soc_clim,0.95,igraph::layout_with_graphopt)
hist(igraph::degree(network_soc_clim_95), ylim=c(0,600), xlab="Degree", main='Degree distribution with threshold 90%')
```
```{r echo=FALSE}
cn <- c("Measurement", "Value")
nonodes <- c("Number of nodes",igraph::vcount(network_soc_clim_35))
noedges <- c("Number of edges",igraph::ecount(network_soc_clim_35))
trans <- c("Transitivity", sprintf(igraph::transitivity(network_soc_clim_35), fmt = '%#.3f'))
dens <- c("Graph density", sprintf(igraph::edge_density(network_soc_clim_35), fmt = '%#.3f'))
avg_path <- c("Average path length", sprintf(igraph::mean_distance(network_soc_clim_35), fmt = '%#.3f'))
diam <- c("Diameter", igraph::diameter(network_soc_clim_35))
tab <- rbind(cn, nonodes,noedges,trans, dens, avg_path, diam)
rownames(tab) <- NULL
knitr::kable(tab, caption = "Statistics for climate network with threshold 35%")

cn <- c("Measurement", "Value")
nonodes <- c("Number of nodes",igraph::vcount(network_soc_clim_95))
noedges <- c("Number of edges",igraph::ecount(network_soc_clim_95))
trans <- c("Transitivity", sprintf(igraph::transitivity(network_soc_clim_95), fmt = '%#.3f'))
dens <- c("Graph density", sprintf(igraph::edge_density(network_soc_clim_95), fmt = '%#.3f'))
avg_path <- c("Average path length", sprintf(igraph::mean_distance(network_soc_clim_95), fmt = '%#.3f'))
diam <- c("Diameter", igraph::diameter(network_soc_clim_95))
tab <- rbind(cn, nonodes,noedges,trans, dens, avg_path, diam)
rownames(tab) <- NULL
knitr::kable(tab, caption = "Statistics for climate network with threshold 95%")
```


```{r echo=FALSE}
#Plot network
par(mfrow=c(1,2))
network_ind_clim_35 <- plot_network_perc(edges_ind_clim,0.35,igraph::layout_with_lgl)
hist(igraph::degree(network_ind_clim_35), ylim=c(0,600), xlab="Degree", main='Degree distribution with threshold 35%')

par(mfrow=c(1,2))
network_ind_clim_95 <- plot_network_perc(edges_ind_clim,0.95,igraph::layout_with_graphopt)
hist(igraph::degree(network_ind_clim_95), ylim=c(0,600), xlab="Degree", main='Degree distribution with threshold 95%')
```

```{r echo=FALSE}
cn <- c("Measurement", "Value")
nonodes <- c("Number of nodes",igraph::vcount(network_ind_clim_35))
noedges <- c("Number of edges",igraph::ecount(network_ind_clim_35))
trans <- c("Transitivity", sprintf(igraph::transitivity(network_ind_clim_35), fmt = '%#.3f'))
dens <- c("Graph density", sprintf(igraph::edge_density(network_ind_clim_35), fmt = '%#.3f'))
avg_path <- c("Average path length", sprintf(igraph::mean_distance(network_ind_clim_35), fmt = '%#.3f'))
diam <- c("Diameter", igraph::diameter(network_ind_clim_35))
tab <- rbind(cn, nonodes,noedges,trans, dens, avg_path, diam)
rownames(tab) <- NULL
knitr::kable(tab, caption = "Statistics for industry network with threshold 35%")

cn <- c("Measurement", "Value")
nonodes <- c("Number of nodes",igraph::vcount(network_ind_clim_95))
noedges <- c("Number of edges",igraph::ecount(network_ind_clim_95))
trans <- c("Transitivity", sprintf(igraph::transitivity(network_ind_clim_95), fmt = '%#.3f'))
dens <- c("Graph density", sprintf(igraph::edge_density(network_ind_clim_95), fmt = '%#.3f'))
avg_path <- c("Average path length", sprintf(igraph::mean_distance(network_ind_clim_95), fmt = '%#.3f'))
diam <- c("Diameter", igraph::diameter(network_ind_clim_95))
tab <- rbind(cn, nonodes,noedges,trans, dens, avg_path, diam)
rownames(tab) <- NULL
knitr::kable(tab, caption = "Statistics for industry network with threshold 95%")
```

```{r echo=FALSE}
#Creating network objects of all required igraph objects
w_network_soc_clim_nw <- intergraph::asNetwork(w_network_soc_clim)
w_network_ind_clim_nw <- intergraph::asNetwork(w_network_ind_clim)
network_soc_clim_35_nw <- intergraph::asNetwork(network_soc_clim_35)
network_soc_clim_95_nw <- intergraph::asNetwork(network_soc_clim_95)
network_ind_clim_35_nw <- intergraph::asNetwork(network_ind_clim_35)
network_ind_clim_95_nw <- intergraph::asNetwork(network_ind_clim_95)
```

### QAP test
In this section the correlation between the the climate vote network and the industry vote network was analysed with QAP-tests to give an initial indication of the answer to the first research question. A QAP test can be used here as both networks cover the same group of MEPs, therefore the linear subspace method can be used. Calculating the correlation here therefore involves comparing the existence of an edge (and its weight if included) between two MEPs in the first network with the existence of an edge between the same two MEPs in the second network.

A QAP test involves permuting both networks multiple times and each time calculating the correlation of the two networks to create a distribution of correlations.This is then compared to the correlations of the original networks to see if the statistic that is calculated on the original graphs is extreme for a graph controlled by this size and structure. This likeliness of observing this statistic is reflected in the p-value returned.This therefore uses the original graph and creates a distribution based for comparison of what the association would be under the null hypothesis of there being no association. The product-moment correlation statistic is used here as the most common statistic for correlation in networks [@MEGHANATHAN2021339].

QAP tests were carried out on the full network, the 35% threshold network, the 95% threshold network and with the weighted networks for full coverage and also to see if there is different association at different level of agreement. For example, it's possible that there could be less correlation with lower thresholds due to random noise that could come from a chance agreement between two MEPs. In contrast, in the the comparison of the two 95% networks we expect an extremely high level of correlation as the agreement is not then likely by chance. This is particularly true in this case as it can be expected that if an MEP has a strong opinion on what should be done regarding the human impact of climate change that they would also have strong opinions about what could be done in industry that might improve/ worsen the climate issue. 

The resulting graphs from the QAP tests can be viewed below. It can be immediately seen that the correlation between both networks in all four tests is very significant. The correlation between the full networks (an edge between MEPs if they agree at least once) has a high correlation of 0.641 (p-value = 0.000). However, upon examination this is likely due to the very high number of edges in the initial network- if all MEPs agree with the other MEPs on at least one vote then the whole network will be connected. This is reflected in the high densities of these graphs (0.964 and 0.977). This would explain the very high level of association as the probability is therefore very high that there will be a matching edge in the other network. 

The result from the thresholded networks is perhaps then more interesting.There is a lower but still significant correlation of voting agreement in the 35% networks of 0.346 (p-value= 0.000) and a slightly higher correlation with the 95% network of 0.397 (p-value= 0.000). The decrease in correlation compared to the initial network will be due to us now comparing far sparser networks, there is less chance that two MEPs agree 35% or 95% of the time so therefore a lower probability that a pair of MEPs will have an edge between them in both networks. However, the higher correlation in the 95% graph compared to the 35% graph is likely due to the high threshold set. While the 35% thresholded networks could still include pairs of MEPs who agreed with each other by chance 35% of the time this is extremely unlikely with the 95% network. These networks therefore focus on very specific voting agreement. An example of this voting agreement can be seen by examining the edges present in the 95% graphs as in both networks nearly all members of the The Progressive Alliance of Socialists and Democrats party completely agree with each other. This is an example of the behaviour that can cause the association in the networks noted here.

Finally, the most interesting result is perhaps the QAP results from the weighted networks. As opposed to the tests carried out on the binary networks this test also includes the information about the amount of agreement (measured as a percentage) between the two MEPs. Unlike the other QAP graphs, here there is an overlap between the result observed in the networks and the permuted graphs in the QAP test. However, the correlation between the two graphs is still highly significant with a correlation of 0.03 (p-value:0.004) 

```{r echo=FALSE}
par(mfrow = c(2,2), cex=0.6)
mepCor <- sna::qaptest(list(w_network_soc_clim_nw, w_network_ind_clim_nw), 
                       FUN = sna::gcor, g1 = 1, g2 = 2,mode='graph', reps = 1000)
sum_mepCor <- summary(mepCor)
sna::plot.qaptest(mepCor, xlim=c(min(sum_mepCor[[2]])-0.005,sum_mepCor[[1]]))
mepCor35 <- sna::qaptest(list(network_soc_clim_35_nw, network_ind_clim_35_nw), 
                       FUN = sna::gcor, g1 = 1, g2 = 2,mode='graph',reps = 1000)
sum_mepCor35 <- summary(mepCor35)
sna::plot.qaptest(mepCor35, xlim=c(min(sum_mepCor35[[2]])-0.005,sum_mepCor35[[1]]))
mepCor95 <- sna::qaptest(list(network_soc_clim_95_nw, network_ind_clim_95_nw), 
                       FUN = sna::gcor, g1 = 1, g2 = 2, mode='graph', reps = 1000)
sum_mepCor95 <- summary(mepCor95)
sna::plot.qaptest(mepCor95, xlim=c(min(sum_mepCor95[[2]])-0.005,sum_mepCor95[[1]]))
s_m <- network::as.sociomatrix(w_network_soc_clim_nw,matrix.type='adjacency',attrname='weight')
i_m <- network::as.sociomatrix(w_network_ind_clim_nw,matrix.type='adjacency',attrname='weight')
mepCor <- sna::qaptest(list(s_m, i_m), 
                       FUN = sna::gcor, g1 = 1, g2 = 2,mode='graph', reps = 1000)
sum_mepCor_w <- summary(mepCor)
sna::plot.qaptest(mepCor, xlim=c(min(sum_mepCor_w[[2]])-0.005,sum_mepCor_w[[1]]))
```

From the results it can therefore be concluded that there is an association between how pairs of MEPs agreed in the social climate bill and the industrial climate bill for both weighted agreement, with thresholds for incidental agreement and almost total agreement.This therefore provides evidence in line with the first hypothesis of this paper.


### ERGM 
<!--
ERGM Description (about 1000) – 2.5 POINTS

* Present your results appropriately (plots, tables…) and discuss your findings 
in plain English

* Discuss the meaning of your findings in relation to your hypothesis. (half of 
the points evaluated in this other part)
-->

Option 1: 

```{r model 1, echo = FALSE}
# model results display example
ctl <- c(4.17,5.58,5.18,6.11,4.50,4.61,5.17,4.53,5.33,5.14)
trt <- c(4.81,4.17,4.41,3.59,5.87,3.83,6.03,4.89,4.32,4.69)
group <- gl(2, 10, 20, labels = c("Ctl","Trt"))
weight <- c(ctl, trt)
lm.D9 <- lm(weight ~ group)
lm.D90 <- lm(weight ~ group - 1)

# install.packages("texreg")

knitr::kable(texreg::matrixreg(lm.D9))


```

Option 2

```{r model 2, echo = FALSE, results = 'asis'}
# model results display example
ctl <- c(4.17,5.58,5.18,6.11,4.50,4.61,5.17,4.53,5.33,5.14)
trt <- c(4.81,4.17,4.41,3.59,5.87,3.83,6.03,4.89,4.32,4.69)
group <- gl(2, 10, 20, labels = c("Ctl","Trt"))
weight <- c(ctl, trt)
lm.D9 <- lm(weight ~ group)
lm.D90 <- lm(weight ~ group - 1)

# install.packages("texreg")

knitr::kable(texreg::matrixreg(list(lm.D9, lm.D90)))


```


Option 3

```{r model 3, echo = FALSE}
# model results display example
ctl <- c(4.17,5.58,5.18,6.11,4.50,4.61,5.17,4.53,5.33,5.14)
trt <- c(4.81,4.17,4.41,3.59,5.87,3.83,6.03,4.89,4.32,4.69)
group <- gl(2, 10, 20, labels = c("Ctl","Trt"))
weight <- c(ctl, trt)
lm.D9 <- lm(weight ~ group)
lm.D90 <- lm(weight ~ group - 1)

# install.packages("texreg")


texreg::plotreg(lm.D9)


```


Option 4

```{r model 4, echo = FALSE}
# model results display example
ctl <- c(4.17,5.58,5.18,6.11,4.50,4.61,5.17,4.53,5.33,5.14)
trt <- c(4.81,4.17,4.41,3.59,5.87,3.83,6.03,4.89,4.32,4.69)
group <- gl(2, 10, 20, labels = c("Ctl","Trt"))
weight <- c(ctl, trt)
lm.D9 <- lm(weight ~ group)
lm.D90 <- lm(weight ~ group - 1)

# install.packages("texreg")

texreg::plotreg(list(lm.D9, lm.D90))

```


## Conclusion
<!--
Conclusion Description (about 350 words) – 0.7 POINTS

What were your topic and research questions again? (1 sentence)

What did you learn from the two analysis you run? *** most important point to 
address 0.5 POINTS here

Who benefits from your findings?

What does remain an open problem?

Can you give suggestions for future work in this area?
-->

\newpage

# References

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id="refs" custom-style="Bibliography"></div>
\endgroup


# Appendix

## Detailed QAP results

```{r}
print('QAP results for full networks')
sum_mepCor
print('QAP results for 35% thresholded networks')
sum_mepCor35 
print('QAP results for 95% thresholded networks')
sum_mepCor95
print('QAP results for weighted networks')
sum_mepCor_w
```









Document on the Coal & Steel vote: https://www.europarl.europa.eu/doceo/document/A-9-2021-0102_EN.html
Document on the impacts of climate change: https://www.europarl.europa.eu/doceo/document/A-9-2021-0115_EN.html
<!--
Sources of introduction
--> 
 William P. Eveland Jr., Myiah J. Hutchens & Alyssa C. Morey (2013) Political Network Size and Its Antecedents and Consequences, Political Communication, 30:3, 371-394, DOI: 10.1080/10584609.2012.737433 
 
 Schneider, Volker & Lang, Achim & Leifeld, Philip & Gundelach, Birte. (2007). Political Networks - A Structured Bibliography. 

Lee, Jeongyoon. (2019). The Oxford handbook of political networks: edited by Jennifer Nicoll Victor, Alexander H. Montgomery and Mark Lubell, Oxford, New York, Oxford University Press, 2017, 1008 pp., $175.00 (hardback), ISBN: 9780190228217, DOI:10.1093/oxfordhb/9780190228217.001.0001. International Review of Public Administration. 24. 1-3. 10.1080/12294659.2019.1662655. 

Cherepnalkoski D, Karpf A, Mozetič I, Grčar M (2016) Cohesion and Coalition Formation in the European Parliament: Roll-Call Votes and Twitter Activities. PLoS ONE 11(11): e0166586. https://doi.org/10.1371/journal.pone.0166586

UNIVERSIDAD AUTONOMA DE BARCELONA (2021, 2026) A Network Science Approach to Social Cohesion in European Societies https://cordis.europa.eu/project/id/101020038 
<!--
Sources of vulnerable populations
--> 
Least developed countries expert group - United Nations Climate Change Secretariat (2018) Considerations regarding vulnerable groups, communities and ecosystems in the context of the national adaptiations plans https://unfccc.int/sites/default/files/resource/Considerations%20regarding%20vulnerable.pdf 

Nathanial Matthews, Deon Nel (2019) Climate change hits vulnerable communities first and hardest https://www.iisd.org/articles/climate-change-hits-vulnerable-communities-first-and-hardest 

Public health newswire American public health association (2021) Climate changes health: vulnerable populations https://www.apha.org/topics-and-issues/climate-change/vulnerable-populations 
